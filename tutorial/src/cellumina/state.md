# Initializing State


## Representation

In Cellumina, the **state** of an automaton is represented by grid of unsigned 8-bit integers. This is a very small datatype, meaning we can often hold the entire state grid in our memory, speeding up access.

## Initialization

The ```AutomatonBuilder``` provides a variety of different ways to supply an automaton with an initial state grid.

### By Hand

As mentioned, the state grid is internally represented as ```Grid<u8>```.
It is therefore possible to create a char grid with the methods provided by the [grid library] and pass this to the automaton using ```from_grid```:

[grid library]: https://docs.rs/grid/latest/grid.html

```rust,noplayground
    cellumina::AutomatonBuilder::new()
        .from_grid(
            Grid::from_vec(
                vec![
                    0, 1, 1,
                    1, 0, 0,
                    1, 0, 0,
                    0, 1, 1,
                ], 3)
        )
        .build();
```

If you are initializing your grid from a ```vec```, there is a shortcut via ```from_vec```:

```rust,noplayground
    cellumina::AutomatonBuilder::new()
        .from_vec(
            vec![
                0, 1, 1,
                1, 0, 0,
                1, 0, 0,
                0, 1, 1,
            ], 3)
        .build();
```

The vector must of course not be generated by supplying the literals and can be a lot more elaborate:

```rust,noplayground
    cellumina::AutomatonBuilder::new()
        .from_vec(
            (0..4096)
                .map(|index| {
                    if index <= 64 * 63 || rand::random::<u8>() % 2 == 0 {
                        0
                    } else {
                        1
                    }
                })
                .collect(),
            64,
        )
        .build();
```

Here we have some code generating a 64x64 grid containing all zeroes in the first 63 rows and a randomized last row. This code is taken from the [Rule90] example.

[Rule90]: https://github.com/Linus-Mussmaecher/cellumina/tree/master/examples/rule90

### From a text file

Typing these numbers explicitly inside the code file is somewhat cumbersome.
In order to take a more data-driven approach, automaton states can be directly initialized from a text file with ```from_text_file```:

```rust,noplayground
    cellumina::AutomatonBuilder::new()
        .from_text_file(
            "./examples/sand/sand_init.txt"
        )
        .build();
```

where the argument -- in this case ```"./example.txt"``` -- is anything implementing the ```AsRef<Path>``` trait. 
Usually this will be a string containing the relative path to a file, but you may choose to get a path from a file picker or similar.

The state of your automaton will have one row for each line in the text file, and as many columns as the longest had characters.
Newlines are of course discarded, and shorter lines are filled with spaces.
The characters will be converted into unsigned 8-bit integers as follows:
 * A space, the character ```'0'``` and any other unknown characters is converted to ```0```.
 * The characters ```'0'``` to ```'9'``` are converted to their respective numbers ```0..=9```.
 * The characters ```'a'``` to ```'z'``` are converted to the numbers ```10..=35```.
 * The characters ```'A'``` to ```'Z'``` are converted to the numbers ```36..=63```.

Also, some ```u8```s are reserved as special characters:

 * ```'_'``` is a special character that is used internally to represent out-of-bounds cells when using a [blocking boundary condition](./rules.md). It is converted to ```126```.
 * ```*``` is a second special character used to indicate a wildcard in a [pattern rule](./rules/pattern.md). It is converted to ```127```.

Both of these characters are not to be used when initializing from a text file, and both of these integers are not to be used when initializing directly.


### From an image

See [Colors](./colors.md).